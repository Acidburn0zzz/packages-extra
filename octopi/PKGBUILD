# maintainer: Philip MÃ¼ller <philm[at]manjaro[dog]org>
# maintainer: Roland Singer <roland[at]manjaro[dog]org>

pkgname=octopi
pkgver=0.1.$(date +%m%d)
pkgrel=1
pkgdesc="A pacman frontend using Qt libs"
arch=('i686' 'x86_64')
url="http://octopiproject.wordpress.com"
license=('GPL')
depends=('qt4' 'pacman')
optdepends=('kdesu: for KDE'
            'gksu: for XFCE, Gnome, LXDE, Cinnamon'
            'gnome-keyring: for password management')

#install=install
_git=yes
source=('octopi.desktop')
sha256sums=('76cdb16cd5f40c85fc748a22cf2877c2e50d04692160576988f6a9fd3fd42fe9')

getsource() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $1 ] ; then
    if [ "$_git" == "yes" ] ; then
       cd $1 && git pull origin master
    else
       cd $1 && git pull origin master && git checkout -b $pkgver
    fi
    msg "The local files are updated."
  else
    git clone $2 $1
    if [ "$_git" != "yes" ] ; then
       cd $1 && git checkout -b $pkgver $pkgver
    fi
  fi

  msg "GIT checkout done or server timeout"
}

build() {
  getsource "octopi" "https://github.com/aarnt/octopi.git"

  cd "${srcdir}/${pkgname}"

  qmake-qt4

  make all
}

package() {
  cd "${srcdir}/${pkgname}"
  mkdir -p ${pkgdir}/usr/bin
  cp bin/octopi ${pkgdir}/usr/bin
  mkdir -p ${pkgdir}/usr/share/icons
  install -m644 resources/images/octopi_yellow.png ${pkgdir}/usr/share/icons/octopi.png
  mkdir -p ${pkgdir}/usr/share/applications
  install -m644 ${srcdir}/octopi.desktop ${pkgdir}/usr/share/applications
}
